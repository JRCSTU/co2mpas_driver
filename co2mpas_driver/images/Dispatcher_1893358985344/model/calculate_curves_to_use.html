<html>
 <body>
  <div>
   <input onclick="window.history.back()" type="button" value="Back"/>
   <input onclick="window.history.forward()" type="button" value="Forward"/>
  </div>
  <html>
   <body>
    <div class="highlight" style="background: #f8f8f8">
     <pre style="line-height: 125%"><span></span><span style="color: #AA22FF">@sh</span><span style="color: #666666">.</span>add_function(dsp, outputs<span style="color: #666666">=</span>[<span style="color: #BA2121">'Curves'</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">calculate_curves_to_use</span>(
        poly_spline, Start, Stop, Alimit, car_res_curve, sp_bins):
    <span style="color: #BA2121; font-style: italic">"""</span>
<span style="color: #BA2121; font-style: italic">    Get the final speed acceleration curves based on full load curves and</span>
<span style="color: #BA2121; font-style: italic">    resistances for all curves.</span>

<span style="color: #BA2121; font-style: italic">    :param poly_spline:</span>
<span style="color: #BA2121; font-style: italic">        Poly spline.</span>
<span style="color: #BA2121; font-style: italic">    :type poly_spline:</span>

<span style="color: #BA2121; font-style: italic">    :param Start:</span>
<span style="color: #BA2121; font-style: italic">        Start speed per gear.</span>
<span style="color: #BA2121; font-style: italic">    :type Start: list</span>

<span style="color: #BA2121; font-style: italic">    :param Stop:</span>
<span style="color: #BA2121; font-style: italic">        Stop speed per gear.</span>
<span style="color: #BA2121; font-style: italic">    :type Stop: list</span>

<span style="color: #BA2121; font-style: italic">    :param Alimit:</span>
<span style="color: #BA2121; font-style: italic">        Maximum acceleration possible.</span>
<span style="color: #BA2121; font-style: italic">    :type Alimit: float</span>

<span style="color: #BA2121; font-style: italic">    :param car_res_curve:</span>
<span style="color: #BA2121; font-style: italic">        Car resistance curve.</span>
<span style="color: #BA2121; font-style: italic">    :type car_res_curve:</span>

<span style="color: #BA2121; font-style: italic">    :param sp_bins:</span>
<span style="color: #BA2121; font-style: italic">        Speed boundaries per gear.</span>
<span style="color: #BA2121; font-style: italic">    :type sp_bins: numpy.array</span>

<span style="color: #BA2121; font-style: italic">    :return:</span>
<span style="color: #BA2121; font-style: italic">        Final speed and acceleration curves.</span>
<span style="color: #BA2121; font-style: italic">    :rtype: list</span>
<span style="color: #BA2121; font-style: italic">    """</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">scipy.interpolate</span> <span style="color: #008000; font-weight: bold">import</span> interp1d
    Res <span style="color: #666666">=</span> []

    <span style="color: #008000; font-weight: bold">for</span> gear, acc <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(poly_spline):
        start <span style="color: #666666">=</span> Start[gear] <span style="color: #666666">*</span> <span style="color: #666666">0.9</span>
        stop <span style="color: #666666">=</span> Stop[gear] <span style="color: #666666">+</span> <span style="color: #666666">0.1</span>

        final_acc <span style="color: #666666">=</span> acc(sp_bins) <span style="color: #666666">-</span> car_res_curve(sp_bins)
        final_acc[final_acc <span style="color: #666666">&gt;</span> Alimit] <span style="color: #666666">=</span> Alimit

        final_acc[(sp_bins <span style="color: #666666">&lt;</span> start)] <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        final_acc[(sp_bins <span style="color: #666666">&gt;</span> stop)] <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        final_acc[final_acc <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

        Res<span style="color: #666666">.</span>append(interp1d(sp_bins, final_acc))

    <span style="color: #008000; font-weight: bold">return</span> Res
</pre>
    </div>
   </body>
  </html>
 </body>
</html>