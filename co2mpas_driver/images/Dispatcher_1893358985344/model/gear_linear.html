<html>
 <body>
  <div>
   <input onclick="window.history.back()" type="button" value="Back"/>
   <input onclick="window.history.forward()" type="button" value="Forward"/>
  </div>
  <html>
   <body>
    <div class="highlight" style="background: #f8f8f8">
     <pre style="line-height: 125%"><span></span><span style="color: #AA22FF">@sh</span><span style="color: #666666">.</span>add_function(dsp, inputs_kwargs<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>, inputs_defaults<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>, outputs<span style="color: #666666">=</span>[<span style="color: #BA2121">'gs'</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">gear_linear</span>(speed_per_gear, gear_shifting_style, use_linear_gs<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>):
    <span style="color: #BA2121; font-style: italic">"""</span>
<span style="color: #BA2121; font-style: italic">    Return the gear limits based on gear_shifting_style, using linear gear swifting</span>
<span style="color: #BA2121; font-style: italic">    strategy.</span>

<span style="color: #BA2121; font-style: italic">    :param speed_per_gear:</span>
<span style="color: #BA2121; font-style: italic">        Speed per gear.</span>
<span style="color: #BA2121; font-style: italic">    :type speed_per_gear: numpy.array</span>

<span style="color: #BA2121; font-style: italic">    :param gear_shifting_style:</span>
<span style="color: #BA2121; font-style: italic">        Gear shifting style.</span>
<span style="color: #BA2121; font-style: italic">    :type gear_shifting_style: float</span>

<span style="color: #BA2121; font-style: italic">    :param use_linear_gs:</span>
<span style="color: #BA2121; font-style: italic">        Use linear gear shifting.</span>
<span style="color: #BA2121; font-style: italic">    :type use_linear_gs: bool</span>

<span style="color: #BA2121; font-style: italic">    :return:</span>
<span style="color: #BA2121; font-style: italic">        Gear limits.</span>
<span style="color: #BA2121; font-style: italic">    :rtype: list</span>
<span style="color: #BA2121; font-style: italic">    """</span>
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> use_linear_gs:
        <span style="color: #008000; font-weight: bold">return</span> sh<span style="color: #666666">.</span>NONE
    n_gears <span style="color: #666666">=</span> <span style="color: #008000">len</span>(speed_per_gear)

    gear_shifting_style <span style="color: #666666">=</span> <span style="color: #008000">min</span>(gear_shifting_style, <span style="color: #666666">1</span>)
    gear_shifting_style <span style="color: #666666">=</span> <span style="color: #008000">max</span>(gear_shifting_style, <span style="color: #666666">0</span>)

    gs <span style="color: #666666">=</span> []

    <span style="color: #008000; font-weight: bold">for</span> gear <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(n_gears <span style="color: #666666">-</span> <span style="color: #666666">1</span>):
        speed_by_gs <span style="color: #666666">=</span> speed_per_gear[gear][<span style="color: #666666">-1</span>] <span style="color: #666666">*</span> gear_shifting_style <span style="color: #666666">+</span> \
                      speed_per_gear[gear][<span style="color: #666666">0</span>] <span style="color: #666666">*</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> gear_shifting_style)
        speed_for_continuity <span style="color: #666666">=</span> speed_per_gear[gear <span style="color: #666666">+</span> <span style="color: #666666">1</span>][<span style="color: #666666">0</span>]
        cutoff_s <span style="color: #666666">=</span> <span style="color: #008000">max</span>(speed_by_gs, speed_for_continuity)

        gs<span style="color: #666666">.</span>append(cutoff_s)

    <span style="color: #008000; font-weight: bold">return</span> gs
</pre>
    </div>
   </body>
  </html>
 </body>
</html>