<html>
 <body>
  <div>
   <input onclick="window.history.back()" type="button" value="Back"/>
   <input onclick="window.history.forward()" type="button" value="Forward"/>
  </div>
  <html>
   <body>
    <div class="highlight" style="background: #f8f8f8">
     <pre style="line-height: 125%"><span></span><span style="color: #AA22FF">@sh</span><span style="color: #666666">.</span>add_function(dsp, outputs<span style="color: #666666">=</span>[<span style="color: #BA2121">'gears'</span>, <span style="color: #BA2121">'velocities'</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">run_simulation</span>(transmission, starting_speed, gs, times, Curves, desired_velocity,
                   driver_style):
    <span style="color: #BA2121; font-style: italic">"""</span>
<span style="color: #BA2121; font-style: italic">    Run simulation.</span>

<span style="color: #BA2121; font-style: italic">    :param transmission:</span>
<span style="color: #BA2121; font-style: italic">        Transmission type of vehicle.</span>
<span style="color: #BA2121; font-style: italic">    :type transmission: str</span>

<span style="color: #BA2121; font-style: italic">    :param starting_speed:</span>
<span style="color: #BA2121; font-style: italic">        Current speed.</span>
<span style="color: #BA2121; font-style: italic">    :type starting_speed: int</span>

<span style="color: #BA2121; font-style: italic">    :param gs: list</span>
<span style="color: #BA2121; font-style: italic">        Gear shifting style.</span>
<span style="color: #BA2121; font-style: italic">    :type gs: int</span>

<span style="color: #BA2121; font-style: italic">    :param times:</span>
<span style="color: #BA2121; font-style: italic">        Sample time series.</span>
<span style="color: #BA2121; font-style: italic">    :type times: np.array</span>

<span style="color: #BA2121; font-style: italic">    :param Curves: list</span>
<span style="color: #BA2121; font-style: italic">        Final acceleration curves.</span>
<span style="color: #BA2121; font-style: italic">    :type Curves: list</span>

<span style="color: #BA2121; font-style: italic">    :param desired_velocity:</span>
<span style="color: #BA2121; font-style: italic">        Desired velocity.</span>
<span style="color: #BA2121; font-style: italic">    :type desired_velocity: int</span>

<span style="color: #BA2121; font-style: italic">    :param driver_style:</span>
<span style="color: #BA2121; font-style: italic">        Driving style.</span>
<span style="color: #BA2121; font-style: italic">    :type driver_style: int</span>

<span style="color: #BA2121; font-style: italic">    :return:</span>
<span style="color: #BA2121; font-style: italic">        Speeds &amp; Acceleration</span>
<span style="color: #BA2121; font-style: italic">    :rtype: list, list</span>
<span style="color: #BA2121; font-style: italic">    """</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">.simulation</span> <span style="color: #008000; font-weight: bold">import</span> gear_for_speed_profiles, simulation_step_function
    velocities <span style="color: #666666">=</span> [starting_speed]

    speed <span style="color: #666666">=</span> starting_speed

    <span style="color: #408080; font-style: italic"># Returns the gear that must be used and the clutch condition</span>
    gear, gear_count <span style="color: #666666">=</span> gear_for_speed_profiles(gs, speed, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>)
    gear_count <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    gears <span style="color: #666666">=</span> [gear]

    <span style="color: #408080; font-style: italic"># Core loop</span>
    <span style="color: #008000; font-weight: bold">for</span> dt <span style="color: #AA22FF; font-weight: bold">in</span> np<span style="color: #666666">.</span>diff(times):
        speed, gear, gear_count <span style="color: #666666">=</span> simulation_step_function(
            transmission, speed, gear, gear_count, gs, Curves,
            desired_velocity, driver_style, dt
        )

        <span style="color: #408080; font-style: italic"># Gather data</span>
        gears<span style="color: #666666">.</span>append(gear)
        velocities<span style="color: #666666">.</span>append(speed)
    <span style="color: #008000; font-weight: bold">return</span> gears, velocities
</pre>
    </div>
   </body>
  </html>
 </body>
</html>