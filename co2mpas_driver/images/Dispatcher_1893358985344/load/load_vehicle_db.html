<html>
 <body>
  <div>
   <input onclick="window.history.back()" type="button" value="Back"/>
   <input onclick="window.history.forward()" type="button" value="Forward"/>
  </div>
  <html>
   <body>
    <div class="highlight" style="background: #f8f8f8">
     <pre style="line-height: 125%"><span></span><span style="color: #AA22FF">@sh</span><span style="color: #666666">.</span>add_function(dsp, outputs<span style="color: #666666">=</span>[<span style="color: #BA2121">'vehicle_db'</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">load_vehicle_db</span>(db_path):
    <span style="color: #BA2121; font-style: italic">"""</span>
<span style="color: #BA2121; font-style: italic">    Load vehicle data base.</span>

<span style="color: #BA2121; font-style: italic">    :param db_path:</span>
<span style="color: #BA2121; font-style: italic">        Data base file path.</span>
<span style="color: #BA2121; font-style: italic">    :type db_path: str</span>

<span style="color: #BA2121; font-style: italic">    :return:</span>
<span style="color: #BA2121; font-style: italic">        Vehicle database.</span>
<span style="color: #BA2121; font-style: italic">    :rtype: dict</span>
<span style="color: #BA2121; font-style: italic">    """</span>
    <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">pandas</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">pd</span>
    df <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(db_path, encoding<span style="color: #666666">=</span><span style="color: #BA2121">"ISO-8859-1"</span>, index_col<span style="color: #666666">=0</span>)
    df <span style="color: #666666">=</span> df[<span style="color: #008000">list</span>(_db_map)]<span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>_db_map)

    df[<span style="color: #BA2121">'gear_box_ratios'</span>] <span style="color: #666666">=</span> df[<span style="color: #BA2121">'gear_box_ratios'</span>]<span style="color: #666666">.</span>fillna(<span style="color: #BA2121">'[]'</span>)<span style="color: #666666">.</span>apply(
        <span style="color: #008000; font-weight: bold">lambda</span> x: [<span style="color: #008000">float</span>(v) <span style="color: #008000; font-weight: bold">for</span> v <span style="color: #AA22FF; font-weight: bold">in</span> x[<span style="color: #666666">1</span>:<span style="color: #666666">-1</span>]<span style="color: #666666">.</span>split(<span style="color: #BA2121">'-'</span>) <span style="color: #008000; font-weight: bold">if</span> v <span style="color: #666666">!=</span> <span style="color: #BA2121">''</span>]
    )
    df<span style="color: #666666">.</span>loc[df[<span style="color: #BA2121">'fuel_type'</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">'petrol'</span>, <span style="color: #BA2121">'ignition_type'</span>] <span style="color: #666666">=</span> <span style="color: #BA2121">'positive'</span>
    df<span style="color: #666666">.</span>loc[df[<span style="color: #BA2121">'fuel_type'</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">'diesel'</span>, <span style="color: #BA2121">'ignition_type'</span>] <span style="color: #666666">=</span> <span style="color: #BA2121">'compression'</span>
    b <span style="color: #666666">=</span> df[<span style="color: #BA2121">'fuel_type'</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">'electricity'</span>
    df<span style="color: #666666">.</span>loc[b, [<span style="color: #BA2121">'ignition_type'</span>, <span style="color: #BA2121">'gear_box_ratios'</span>]] <span style="color: #666666">=</span> np<span style="color: #666666">.</span>nan
    df[<span style="color: #BA2121">'tyre_radius'</span>] <span style="color: #666666">/=</span> <span style="color: #666666">1000</span>  <span style="color: #408080; font-style: italic"># meters.</span>
    df[<span style="color: #BA2121">'driveline_slippage'</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

    b <span style="color: #666666">=</span> df[<span style="color: #BA2121">'gearbox_type'</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">'automatic'</span>
    b <span style="color: #666666">|=</span> df[<span style="color: #BA2121">'gearbox_type'</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">'single-speed fixed gear'</span>
    df[<span style="color: #BA2121">'transmission'</span>] <span style="color: #666666">=</span> np<span style="color: #666666">.</span>where(b, <span style="color: #BA2121">'automatic'</span>, <span style="color: #BA2121">'manual'</span>)
    df[<span style="color: #BA2121">'driveline_efficiency'</span>] <span style="color: #666666">=</span> np<span style="color: #666666">.</span>where(b, <span style="color: #666666">.9</span>, <span style="color: #666666">.93</span>)

    df[<span style="color: #BA2121">'vehicle_max_speed'</span>] <span style="color: #666666">=</span> (df[<span style="color: #BA2121">'vehicle_max_speed'</span>] <span style="color: #666666">/</span> <span style="color: #666666">3.6</span>)<span style="color: #666666">.</span>values<span style="color: #666666">.</span>astype(<span style="color: #008000">int</span>)
    df[<span style="color: #BA2121">'type_of_car'</span>] <span style="color: #666666">=</span> df[<span style="color: #BA2121">"type_of_car"</span>]<span style="color: #666666">.</span>str<span style="color: #666666">.</span>strip()
    r <span style="color: #666666">=</span> np<span style="color: #666666">.</span>where(df[<span style="color: #BA2121">'car_type'</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">'front'</span>, <span style="color: #666666">2</span>, <span style="color: #666666">6</span>)
    r[df[<span style="color: #BA2121">'car_type'</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">'rear'</span>] <span style="color: #666666">=</span> <span style="color: #666666">4</span>
    df[<span style="color: #BA2121">'car_type'</span>] <span style="color: #666666">=</span> r

    b <span style="color: #666666">=</span> df[<span style="color: #BA2121">'ignition_type'</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">'positive'</span>
    df[<span style="color: #BA2121">'idle_engine_speed_median'</span>] <span style="color: #666666">=</span> np<span style="color: #666666">.</span>where(b, <span style="color: #666666">750</span>, <span style="color: #666666">850</span>)
    df[<span style="color: #BA2121">'idle_engine_speed_std'</span>] <span style="color: #666666">=</span> <span style="color: #666666">50</span>
    df[<span style="color: #BA2121">'r_dynamic'</span>] <span style="color: #666666">/=</span> <span style="color: #666666">1000</span>

    <span style="color: #008000; font-weight: bold">return</span> df<span style="color: #666666">.</span>to_dict(<span style="color: #BA2121">'index'</span>)
</pre>
    </div>
   </body>
  </html>
 </body>
</html>